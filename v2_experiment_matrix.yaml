# V2_1 & V2_2 Enhanced Experiment Matrix
# ë‹¤ì–‘í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„° ì¡°í•©ì„ ìžë™ìœ¼ë¡œ ì‹¤í—˜

# V2_1 ì‹¤í—˜êµ°: "ëŒ€í˜• ëª¨ë¸ + ìž¥ê¸° í•™ìŠµ" ì „ëžµ
v2_1_experiments:
  base_config: "config_v2_1.yaml"
  experiment_name: "v2_1"
  variations:
    # ëª¨ë¸ ë³€í˜•
    models:
      - name: "convnextv2_base"
        model_name: "convnextv2_base.fcmae_ft_in22k_in1k_384"
        patience: 25
      - name: "convnextv2_large"  
        model_name: "convnextv2_large.fcmae_ft_in22k_in1k_384"
        patience: 40
      - name: "efficientnetv2_l"
        model_name: "tf_efficientnetv2_l.in21k_ft_in1k"
        patience: 35
    
    # í•™ìŠµë¥  ì¡°í•©
    learning_rates:
      - name: "lr_low"
        lr: 0.00005
      - name: "lr_medium"
        lr: 0.0001
      - name: "lr_high"
        lr: 0.0002
    
    # ë°°ì¹˜ í¬ê¸°
    batch_sizes:
      - name: "batch_16"
        batch_size: 16
      - name: "batch_32"
        batch_size: 32
      - name: "batch_48"
        batch_size: 48
    
    # ðŸ”¥ NEW: Mixup/CutMix ì˜¨ë¼ì¸ ì¦ê°• ì˜µì…˜
    online_augmentations:
      - name: "mixup"
        online_aug:
          mixup: True
          cutmix: False
          alpha: 0.4
          num_classes: 17
      - name: "cutmix"
        online_aug:
          mixup: False
          cutmix: True
          alpha: 0.4
          num_classes: 17
      - name: "none"
        online_aug:
          mixup: False
          cutmix: False
          alpha: 0.4
          num_classes: 17
    
    # ìŠ¤ì¼€ì¤„ëŸ¬ ë³€í˜•
    schedulers:
      - name: "warmup_short"
        scheduler_params:
          T_max: 5000
          warmup_steps: 3
      - name: "warmup_long"
        scheduler_params:
          T_max: 10000
          warmup_steps: 10

# V2_2 ì‹¤í—˜êµ°: "íš¨ìœ¨ì  + ê¸°ë²• ì¡°í•©" ì „ëžµ  
v2_2_experiments:
  base_config: "config_v2_2.yaml"
  experiment_name: "v2_2"
  variations:
    # ëª¨ë¸ ë³€í˜•
    models:
      - name: "resnet50"
        model_name: "resnet50.tv2_in1k"
      - name: "resnet101"
        model_name: "resnet101.tv2_in1k"
      - name: "efficientnet_b4"
        model_name: "efficientnet_b4.ra2_in1k"
    
    # ì†ì‹¤í•¨ìˆ˜ ì¡°í•©
    criterions:
      - name: "focal"
        criterion: "FocalLoss"
      - name: "ce"
        criterion: "CrossEntropyLoss"
      - name: "label_smooth"
        criterion: "LabelSmoothingLoss"
        label_smooth: 0.1
    
    # ì¦ê°• ê¸°ë²• ì¡°í•©
    augmentations:
      - name: "mixup"
        online_aug:
          mixup: true
          cutmix: false
        dynamic_augmentation:
          enabled: false
      - name: "cutmix"
        online_aug:
          mixup: false
          cutmix: true
        dynamic_augmentation:
          enabled: false
      - name: "dynamic"
        online_aug:
          mixup: false
          cutmix: false
        dynamic_augmentation:
          enabled: true
      - name: "mixup_dynamic"
        online_aug:
          mixup: true
          cutmix: false
        dynamic_augmentation:
          enabled: true
    
    # 2-stage í•™ìŠµ ì¡°í•©
    two_stage_options:
      - name: "single"
        two_stage: false
      - name: "two_stage"
        two_stage: true
        stage2_config: "config_2stage_2.yaml"

# êµì°¨ ê²€ì¦ ì‹¤í—˜
cross_validation_experiments:
  base_config: "config_v2_2.yaml"
  experiment_name: "cv"
  variations:
    folds:
      - name: "cv3"
        n_folds: 3
      - name: "cv5"  
        n_folds: 5
    models:
      - name: "resnet50"
        model_name: "resnet50.tv2_in1k"
      - name: "efficientnet_b4"
        model_name: "efficientnet_b4.ra2_in1k"

# ì‹¤í—˜ ìš°ì„ ìˆœìœ„ ë° í•„í„°ë§
experiment_priority:
  # 1ë‹¨ê³„: ê¸°ë³¸ ì„±ëŠ¥ í™•ì¸
  phase1:
    - "v2_1.convnextv2_base.lr_medium.batch_32.warmup_short"
    - "v2_2.resnet50.focal.mixup.single"
    - "v2_2.resnet50.focal.cutmix.single"
  
  # 2ë‹¨ê³„: ëª¨ë¸ ë¹„êµ
  phase2:
    - "v2_1.convnextv2_large.*"
    - "v2_2.efficientnet_b4.*"
  
  # 3ë‹¨ê³„: í•˜ì´í¼íŒŒë¼ë¯¸í„° ìµœì í™”
  phase3:
    - "v2_1.*.lr_*.*.*"
    - "v2_2.*.*.dynamic.*"
  
  # 4ë‹¨ê³„: ê³ ê¸‰ ê¸°ë²•
  phase4:
    - "v2_2.*.*.two_stage"
    - "cv.*"

# ì‹¤í—˜ ì œì•½ ì¡°ê±´
constraints:
  # ë©”ëª¨ë¦¬ ì œì•½
  memory_limit:
    convnextv2_large:
      max_batch_size: 16
    efficientnetv2_l:
      max_batch_size: 8
  
  # ì‹œê°„ ì œì•½  
  time_limit:
    v2_1: 48  # hours
    v2_2: 24  # hours
    cv: 72    # hours
  
  # GPU ìš”êµ¬ì‚¬í•­
  gpu_requirements:
    convnextv2_large: ">=16GB"
    efficientnetv2_l: ">=24GB"